var GZ3D=GZ3D||{REVISION:"1"};GZ3D.GZIface=function(a){this.scene=a,this.Init()},GZ3D.GZIface.prototype.Init=function(){this.webSocket=new ROSLIB.Ros({url:"ws://localhost:7681"});var a=new ROSLIB.Topic({ros:this.webSocket,name:"~/scene",messageType:"scene"}),b=function(a){for(var b=0;b<a.model.length;++b){var c=a.model[b],d=new THREE.Object3D;d.name=c.name,c.pose&&(d.position=c.pose.position,d.quaternion=c.pose.orientation);for(var e=0;e<c.link.length;++e){var f=c.link[e],g=new THREE.Object3D;g.name=f.name,f.pose&&(g.position=f.pose.position,g.quaternion=f.pose.orientation),d.add(g);for(var h=0;h<f.visual.length;++h){var i=f.visual[h];if(i.geometry){var j=i.geometry,k=new THREE.Object3D;k.name=i.name,i.pose&&(k.position=i.pose.position,k.quaternion=i.pose.orientation),this.scene.CreateGeom(j,i.material,k),g.add(k)}}}this.scene.Add(d)}};a.subscribe(b.bind(this));var c=new ROSLIB.Topic({ros:this.webSocket,name:"~/pose/info",messageType:"pose"}),d=function(a){var b=this.scene.GetByName(a.name);b&&(b.position=a.position,b.quaternion=a.orientation)};c.subscribe(d.bind(this));var e=new ROSLIB.Topic({ros:this.webSocket,name:"~/request",messageType:"request"}),f=function(a){if("entity_delete"===a.request){var b=this.scene.GetByName(a.data);console.log("remove "+b.name),this.scene.Remove(b)}};e.subscribe(f.bind(this))},GZ3D.Scene=function(){this.Init()},GZ3D.Scene.prototype.Init=function(){this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!1}),this.renderer.setClearColor(13421772,1),this.renderer.setSize(window.innerWidth,window.innerHeight);var a=new THREE.DirectionalLight(16777215);a.position.set(1,1,1),this.scene.add(a),a=new THREE.AmbientLight(2236962),this.scene.add(a);var b=new THREE.GridHelper(10,1);b.rotation.x=.5*Math.PI,this.scene.add(b),this.camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.x=0,this.camera.position.y=-5,this.camera.position.z=5,this.camera.up=new THREE.Vector3(0,0,1),this.camera.lookAt(0,0,0),this.controls=new THREE.TrackballControls(this.camera),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.noZoom=!1,this.controls.noPan=!1,this.controls.staticMoving=!0,this.controls.dynamicDampingFactor=.3,this.controls.keys=[65,83,68],this.controls.addEventListener("change",this.Render.call(this)),this.iface=new GZ3D.GZIface(this)},GZ3D.Scene.prototype.GetDomElement=function(){return this.renderer.domElement},GZ3D.Scene.prototype.Render=function(){this.renderer.render(this.scene,this.camera),this.controls.update()},GZ3D.Scene.prototype.SetWindowSize=function(a,b){this.camera.aspect=a/b,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,b),this.controls.handleResize(),this.Render()},GZ3D.Scene.prototype.Add=function(a){this.scene.add(a)},GZ3D.Scene.prototype.Remove=function(a){this.scene.remove(a)},GZ3D.Scene.prototype.GetByName=function(a){return console.log("get "+a),this.scene.getObjectByName(a)},GZ3D.Scene.prototype.CreateGeom=function(a,b,c){var d;a.box&&(d=this.CreateBox(a.box.size.x,a.box.size.y,a.box.size.z)),a.cylinder&&(d=this.CreateCylinder(a.cylinder.radius,a.cylinder.length)),a.sphere&&(d=this.CreateSphere(a.sphere.radius)),d&&(d.updateMatrix(),c.add(d))},GZ3D.Scene.prototype.CreateSphere=function(a){var b=new THREE.SphereGeometry(a,32,32),c=new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading}),d=new THREE.Mesh(b,c);return d},GZ3D.Scene.prototype.CreateCylinder=function(a,b){var c=new THREE.CylinderGeometry(a,a,b,32,1,!1),d=new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading}),e=new THREE.Mesh(c,d);return e.rotation.x=.5*Math.PI,e},GZ3D.Scene.prototype.CreateBox=function(a,b,c){var d=new THREE.CubeGeometry(a,b,c,1,1,1),e=new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading}),f=new THREE.Mesh(d,e);return f};